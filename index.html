<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS FABRIC v4 | Real Use Cases Marketplace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --accent-blue: #3b82f6;
            --accent-purple: #a855f7;
            --success: #10b981;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-blue); }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); }
            50% { box-shadow: 0 0 25px rgba(59, 130, 246, 0.4); }
        }

        @keyframes status-pulse {
            0% { transform: scale(0.95); opacity: 0.5; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.5; }
        }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(400px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .glass {
            background: rgba(15, 15, 15, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .bg-grid {
            background-image: radial-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .glow-hover:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }

        .status-pulse { animation: status-pulse 2s infinite; }
        .animate-slide-up { animation: slide-up 0.6s ease-out forwards; }
        .animate-slide-in { animation: slide-in-right 0.4s ease-out forwards; }

        .text-gradient {
            background: linear-gradient(to right, #3b82f6, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .csop-badge {
            background: linear-gradient(135deg, #3b82f6 0%, #a855f7 100%);
            animation: pulse-glow 3s infinite;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .tab-button {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #94a3b8;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-grid min-h-screen pb-20">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 glass border-b border-white/5 px-6 py-3">
        <div class="max-w-[1600px] mx-auto flex items-center justify-between">
            <div class="flex items-center gap-8">
                <div class="flex items-center gap-2 group cursor-pointer">
                    <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center group-hover:rotate-12 transition-transform">
                        <i data-lucide="layers" class="w-5 h-5 text-white"></i>
                    </div>
                    <span class="text-xl font-black tracking-tighter text-white">NEXUS <span class="text-blue-500">FABRIC</span></span>
                    <span class="text-[8px] font-bold csop-badge text-white px-2 py-0.5 rounded-full ml-2">v4</span>
                </div>
                <nav class="hidden md:flex items-center gap-6">
                    <a href="#dashboard" class="text-sm font-medium text-white hover:text-blue-400 transition-colors">Dashboard</a>
                    <a href="#marketplace" class="text-sm font-medium text-slate-400 hover:text-blue-400 transition-colors">Marketplace</a>
                    <a href="#provider" onclick="openProviderModal()" class="text-sm font-medium text-slate-400 hover:text-blue-400 transition-colors cursor-pointer">Sell Compute</a>
                    <a href="#wallet" class="text-sm font-medium text-slate-400 hover:text-blue-400 transition-colors">Wallet</a>
                </nav>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="csop-status" class="hidden md:flex items-center gap-2 px-3 py-1.5 glass rounded-lg border border-emerald-500/20">
                    <div class="w-2 h-2 bg-emerald-500 rounded-full status-pulse"></div>
                    <span class="text-[10px] font-mono text-emerald-400 uppercase">CSOP Ready</span>
                </div>
                <div class="flex items-center gap-3 pl-4 border-l border-white/10">
                    <div class="text-right hidden sm:block">
                        <div class="text-xs font-bold text-white uppercase tracking-tight leading-none">User</div>
                        <div id="user-balance" class="text-[10px] font-mono text-emerald-400 mt-1">$0.00</div>
                    </div>
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Alex" class="w-9 h-9 rounded-full bg-slate-800 border border-white/10" alt="Avatar">
                </div>
            </div>
        </div>
    </header>

    <!-- INIT OVERLAY -->
    <div id="init-overlay" class="fixed inset-0 bg-gray-950/95 backdrop-blur-xl z-[100] flex items-center justify-center">
        <div class="text-center space-y-6 animate-slide-up">
            <div class="w-20 h-20 mx-auto bg-blue-600 rounded-2xl flex items-center justify-center mb-6 animate-pulse">
                <i data-lucide="cpu" class="w-10 h-10 text-white"></i>
            </div>
            <h2 class="text-3xl font-black text-white">Initializing NEXUS FABRIC</h2>
            <p class="text-slate-400 text-sm">Loading compute marketplace...</p>
            <div class="flex items-center justify-center gap-3">
                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                <div class="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
            </div>
            <div id="init-status" class="text-xs font-mono text-blue-400 uppercase tracking-wider">
                Loading...
            </div>
        </div>
    </div>

    <!-- PROVIDER MODAL -->
    <div id="provider-modal" class="modal">
        <div class="glass max-w-2xl w-full mx-4 rounded-2xl border border-white/10 overflow-hidden animate-slide-up">
            <div class="px-8 py-6 border-b border-white/5 flex justify-between items-center">
                <h3 class="text-xl font-black text-white">Sell Your Compute Power</h3>
                <button onclick="closeProviderModal()" class="text-slate-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="p-8 space-y-6">
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Pricing Model</label>
                    <select id="pricing-model" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white">
                        <option value="paid">Paid ($$$)</option>
                        <option value="free">Free (Community)</option>
                        <option value="freemium">Freemium (Custom)</option>
                    </select>
                </div>
                
                <div id="price-input-container">
                    <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Price per Task (USD)</label>
                    <input id="price-input" type="number" step="0.01" min="0" value="0.50" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-white font-mono">
                </div>

                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase mb-2 block">Available Resources</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/5 p-4 rounded-lg border border-white/10">
                            <div class="text-[10px] text-slate-500 uppercase mb-1">CPU Cores</div>
                            <div id="available-cores" class="text-2xl font-black text-white">0</div>
                        </div>
                        <div class="bg-white/5 p-4 rounded-lg border border-white/10">
                            <div class="text-[10px] text-slate-500 uppercase mb-1">Memory</div>
                            <div id="available-memory" class="text-2xl font-black text-white">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="bg-blue-600/10 border border-blue-500/20 p-4 rounded-lg">
                    <div class="flex items-start gap-3">
                        <i data-lucide="info" class="w-5 h-5 text-blue-400 mt-0.5"></i>
                        <div class="text-xs text-slate-300">
                            <p class="font-bold text-blue-400 mb-1">How it works:</p>
                            <ul class="space-y-1 text-slate-400">
                                <li>â€¢ Your browser runs tasks in background</li>
                                <li>â€¢ You earn automatically when tasks complete</li>
                                <li>â€¢ You can stop anytime</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <button onclick="activateProvider()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-black uppercase text-sm text-white transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)] flex items-center justify-center gap-2">
                    <i data-lucide="zap" class="w-5 h-5"></i>
                    Start Selling Compute
                </button>
            </div>
        </div>
    </div>

    <main class="max-w-[1600px] mx-auto p-4 md:p-8 space-y-12">
        
        <!-- DASHBOARD -->
        <section id="dashboard" class="animate-slide-up">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-black tracking-tight text-white flex items-center gap-3">
                    <span class="w-1.5 h-8 bg-blue-600 rounded-full"></span>
                    Dashboard
                </h2>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="glass p-6 rounded-2xl glow-hover transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-2 bg-blue-500/10 rounded-lg text-blue-500">
                            <i data-lucide="dollar-sign" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <div class="text-xs font-mono text-slate-500 uppercase tracking-widest mb-1">Total Earned</div>
                    <div id="total-earnings" class="text-3xl font-black text-white tracking-tighter">$0.00</div>
                </div>

                <div class="glass p-6 rounded-2xl glow-hover transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-2 bg-purple-500/10 rounded-lg text-purple-500">
                            <i data-lucide="check-circle" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <div class="text-xs font-mono text-slate-500 uppercase tracking-widest mb-1">Tasks Done</div>
                    <div id="tasks-completed" class="text-3xl font-black text-white tracking-tighter">0</div>
                </div>

                <div class="glass p-6 rounded-2xl glow-hover transition-all">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-2 bg-emerald-500/10 rounded-lg text-emerald-500">
                            <i data-lucide="trending-up" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <div class="text-xs font-mono text-slate-500 uppercase tracking-widest mb-1">Provider Earnings</div>
                    <div id="provider-earnings" class="text-3xl font-black text-white tracking-tighter">$0.00</div>
                </div>

                <div class="glass p-6 rounded-2xl glow-hover transition-all cursor-pointer" onclick="openProviderModal()">
                    <div class="flex justify-between items-start mb-4">
                        <div class="p-2 bg-amber-500/10 rounded-lg text-amber-500">
                            <i data-lucide="cpu" class="w-6 h-6"></i>
                        </div>
                        <span id="provider-status-badge" class="text-xs font-bold text-slate-500 bg-slate-500/10 px-2 py-1 rounded">INACTIVE</span>
                    </div>
                    <div class="text-xs font-mono text-slate-500 uppercase tracking-widest mb-1">Provider Mode</div>
                    <div class="text-lg font-black text-white tracking-tighter">Click to activate</div>
                </div>
            </div>

            <!-- Active Tasks -->
            <div class="glass rounded-2xl overflow-hidden border border-white/5">
                <div class="px-6 py-4 border-b border-white/5 flex justify-between items-center bg-white/2">
                    <h3 class="text-sm font-bold uppercase tracking-widest text-slate-400 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-blue-500 status-pulse"></span>
                        My Active Tasks
                    </h3>
                    <div id="active-tasks-count" class="text-[10px] font-mono text-blue-500">0 ACTIVE</div>
                </div>
                <div class="overflow-x-auto max-h-[300px] overflow-y-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="sticky top-0 bg-gray-950/90 backdrop-blur">
                            <tr class="text-[10px] font-mono text-slate-500 uppercase border-b border-white/5">
                                <th class="px-6 py-3 font-medium">Use Case</th>
                                <th class="px-6 py-3 font-medium">Category</th>
                                <th class="px-6 py-3 font-medium">Progress</th>
                                <th class="px-6 py-3 font-medium">Status</th>
                                <th class="px-6 py-3 font-medium">Cost</th>
                            </tr>
                        </thead>
                        <tbody id="task-list" class="text-sm">
                            <tr>
                                <td colspan="5" class="px-6 py-8 text-center text-slate-500">
                                    <div class="flex flex-col items-center gap-2">
                                        <i data-lucide="inbox" class="w-8 h-8 text-slate-700"></i>
                                        <span class="text-xs">No active tasks. Browse marketplace!</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- MARKETPLACE -->
        <section id="marketplace" class="animate-slide-up">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                <h2 class="text-2xl font-black tracking-tight text-white flex items-center gap-3">
                    <span class="w-1.5 h-8 bg-purple-600 rounded-full"></span>
                    Compute Marketplace
                </h2>
            </div>

            <!-- Category Tabs -->
            <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                <button class="tab-button active" data-category="all" onclick="filterCategory('all')">
                    All Use Cases
                </button>
                <button class="tab-button" data-category="ai" onclick="filterCategory('ai')">
                    ðŸ¤– AI & ML
                </button>
                <button class="tab-button" data-category="image" onclick="filterCategory('image')">
                    ðŸŽ¨ Image Processing
                </button>
                <button class="tab-button" data-category="video" onclick="filterCategory('video')">
                    ðŸŽ¬ Video Processing
                </button>
                <button class="tab-button" data-category="gaming" onclick="filterCategory('gaming')">
                    ðŸŽ® Cloud Gaming
                </button>
                <button class="tab-button" data-category="data" onclick="filterCategory('data')">
                    ðŸ“Š Data Analysis
                </button>
            </div>

            <div id="marketplace-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Dynamic tasks will be injected -->
            </div>
        </section>

        <!-- WALLET -->
        <section id="wallet" class="animate-slide-up">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4 glass rounded-3xl p-8 bg-gradient-to-br from-blue-600/20 to-purple-600/20 border border-white/10 relative overflow-hidden">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-500/20 blur-[60px]"></div>
                    <div class="relative z-10">
                        <div class="text-[10px] font-mono text-blue-400 uppercase tracking-[0.2em] mb-4">Total Balance</div>
                        <div id="wallet-balance" class="text-5xl font-black text-white tracking-tighter mb-8">$0.00</div>
                        
                        <div class="space-y-4 mb-10">
                            <div class="flex justify-between items-center pb-4 border-b border-white/10">
                                <span class="text-xs text-slate-400">From Tasks</span>
                                <span id="consumer-balance" class="text-xs font-bold text-blue-400">$0.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-slate-400">From Selling</span>
                                <span id="provider-balance" class="text-xs font-bold text-emerald-400">$0.00</span>
                            </div>
                        </div>

                        <button onclick="withdrawFunds()" class="w-full py-4 bg-white text-black font-black uppercase tracking-widest text-xs rounded-2xl hover:bg-blue-500 hover:text-white transition-all flex items-center justify-center gap-2">
                            <i data-lucide="arrow-up-right" class="w-4 h-4"></i> Withdraw
                        </button>
                    </div>
                </div>

                <div class="lg:col-span-8 glass rounded-3xl overflow-hidden border border-white/5">
                    <div class="px-8 py-6 border-b border-white/5">
                        <h3 class="text-sm font-bold uppercase tracking-widest text-slate-400">Transaction History</h3>
                    </div>
                    <div class="overflow-y-auto max-h-[400px]" id="transaction-list">
                        <div class="px-8 py-12 text-center text-slate-500">
                            <i data-lucide="wallet" class="w-12 h-12 text-slate-700 mx-auto mb-2"></i>
                            <p class="text-xs">No transactions yet</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-20 right-4 z-50 space-y-2"></div>

    <script type="module">
        lucide.createIcons();

        // USE CASES DATABASE
        const USE_CASES = {
            ai: [
                {
                    id: 'AI_FINETUNE_001',
                    title: 'LoRA Fine-tuning',
                    description: 'Fine-tune Stable Diffusion model with your custom dataset. Low-resource adaptation.',
                    category: 'ai',
                    icon: 'ðŸ§ ',
                    requirements: { ram: '4GB', cores: 2 },
                    duration: '~15 mins',
                    basePrice: 2.50,
                    difficulty: 'MEDIUM'
                },
                {
                    id: 'AI_INFERENCE_002',
                    title: 'Image Generation (SD)',
                    description: 'Generate images using Stable Diffusion. Works on 2GB RAM phones.',
                    category: 'ai',
                    icon: 'ðŸŽ¨',
                    requirements: { ram: '2GB', cores: 2 },
                    duration: '~30 sec',
                    basePrice: 0.25,
                    difficulty: 'LOW'
                },
                {
                    id: 'AI_LLM_003',
                    title: 'Text Generation (LLM)',
                    description: 'Run lightweight LLM inference for chatbot responses.',
                    category: 'ai',
                    icon: 'ðŸ’¬',
                    requirements: { ram: '3GB', cores: 4 },
                    duration: '~5 sec',
                    basePrice: 0.15,
                    difficulty: 'LOW'
                }
            ],
            image: [
                {
                    id: 'IMG_UPSCALE_001',
                    title: 'AI Upscaling 4K',
                    description: 'Upscale images to 4K using Real-ESRGAN. Works on weak phones.',
                    category: 'image',
                    icon: 'ðŸ“¸',
                    requirements: { ram: '2GB', cores: 2 },
                    duration: '~2 mins',
                    basePrice: 0.50,
                    difficulty: 'LOW'
                },
                {
                    id: 'IMG_REMBG_002',
                    title: 'Background Removal',
                    description: 'Remove backgrounds from images automatically.',
                    category: 'image',
                    icon: 'âœ‚ï¸',
                    requirements: { ram: '1GB', cores: 2 },
                    duration: '~10 sec',
                    basePrice: 0.10,
                    difficulty: 'LOW'
                },
                {
                    id: 'IMG_BATCH_003',
                    title: 'Batch Image Compression',
                    description: 'Compress 1000+ images for web optimization.',
                    category: 'image',
                    icon: 'ðŸ—œï¸',
                    requirements: { ram: '2GB', cores: 4 },
                    duration: '~8 mins',
                    basePrice: 1.00,
                    difficulty: 'MEDIUM'
                }
            ],
            video: [
                {
                    id: 'VID_TRANSCODE_001',
                    title: 'Video Transcoding',
                    description: 'Convert video to H.265 for smaller file size. Phone-friendly.',
                    category: 'video',
                    icon: 'ðŸŽ¬',
                    requirements: { ram: '3GB', cores: 4 },
                    duration: '~20 mins',
                    basePrice: 3.00,
                    difficulty: 'HIGH'
                },
                {
                    id: 'VID_THUMBNAIL_002',
                    title: 'Auto Thumbnail Generation',
                    description: 'Generate smart thumbnails from videos.',
                    category: 'video',
                    icon: 'ðŸ–¼ï¸',
                    requirements: { ram: '1GB', cores: 2 },
                    duration: '~30 sec',
                    basePrice: 0.20,
                    difficulty: 'LOW'
                },
                {
                    id: 'VID_SUBTITLE_003',
                    title: 'Auto Subtitle Generation',
                    description: 'Generate subtitles using speech-to-text.',
                    category: 'video',
                    icon: 'ðŸ“',
                    requirements: { ram: '2GB', cores: 2 },
                    duration: '~5 mins',
                    basePrice: 1.50,
                    difficulty: 'MEDIUM'
                }
            ],
            gaming: [
                {
                    id: 'GAME_STREAM_001',
                    title: 'Cloud Gaming Session',
                    description: 'Play AAA games on weak phone. Stream from powerful nodes.',
                    category: 'gaming',
                    icon: 'ðŸŽ®',
                    requirements: { ram: '1GB', cores: 2 },
                    duration: 'per hour',
                    basePrice: 2.00,
                    difficulty: 'LOW'
                },
                {
                    id: 'GAME_APK_002',
                    title: 'Android Game Streaming',
                    description: 'Load your APK in browser. Play any Android game remotely.',
                    category: 'gaming',
                    icon: 'ðŸ“±',
                    requirements: { ram: '512MB', cores: 1 },
                    duration: 'per hour',
                    basePrice: 1.00,
                    difficulty: 'LOW'
                },
                {
                    id: 'GAME_RENDER_003',
                    title: 'Game Asset Rendering',
                    description: 'Render 3D game assets (Blender/Unity).',
                    category: 'gaming',
                    icon: 'ðŸŽ¯',
                    requirements: { ram: '4GB', cores: 8 },
                    duration: '~10 mins',
                    basePrice: 5.00,
                    difficulty: 'HIGH'
                }
            ],
            data: [
                {
                    id: 'DATA_CSV_001',
                    title: 'CSV Data Processing',
                    description: 'Process large CSV files (100k+ rows). Clean, transform, analyze.',
                    category: 'data',
                    icon: 'ðŸ“Š',
                    requirements: { ram: '2GB', cores: 4 },
                    duration: '~3 mins',
                    basePrice: 0.75,
                    difficulty: 'MEDIUM'
                },
                {
                    id: 'DATA_SCRAPE_002',
                    title: 'Web Scraping Job',
                    description: 'Scrape data from websites. Parallel processing on weak devices.',
                    category: 'data',
                    icon: 'ðŸ•·ï¸',
                    requirements: { ram: '1GB', cores: 2 },
                    duration: '~5 mins',
                    basePrice: 1.25,
                    difficulty: 'MEDIUM'
                },
                {
                    id: 'DATA_ML_003',
                    title: 'Dataset Labeling',
                    description: 'Auto-label images/text using ML models.',
                    category: 'data',
                    icon: 'ðŸ·ï¸',
                    requirements: { ram: '2GB', cores: 2 },
                    duration: '~8 mins',
                    basePrice: 2.00,
                    difficulty: 'MEDIUM'
                }
            ]
        };

        // CSOP Implementation
        class CSOP {
            constructor() {
                this.workers = [];
                this.numWorkers = navigator.hardwareConcurrency || 4;
                this.ready = false;
            }

            async init() {
                updateInitStatus('Initializing Web Workers...');
                await this.initWorkers();
                updateInitStatus('CSOP Ready!');
                await new Promise(r => setTimeout(r, 500));
                this.ready = true;
                return true;
            }

            async initWorkers() {
                const workerCode = `
                    self.onmessage = function(e) {
                        const { id, task, data } = e.data;
                        let result;
                        
                        try {
                            // Simulate different task types
                            switch(task) {
                                case 'ai_inference':
                                    result = simulateAI(data);
                                    break;
                                case 'image_process':
                                    result = simulateImageProcessing(data);
                                    break;
                                case 'video_transcode':
                                    result = simulateVideo(data);
                                    break;
                                case 'game_stream':
                                    result = simulateGameStream(data);
                                    break;
                                case 'data_process':
                                    result = simulateDataProcessing(data);
                                    break;
                                default:
                                    result = { computed: true, duration: 1000 };
                            }
                            
                            self.postMessage({ id, status: 'ok', result });
                        } catch (error) {
                            self.postMessage({ id, status: 'error', error: error.message });
                        }
                    };
                    
                    function simulateAI(data) {
                        const start = Date.now();
                        let result = 0;
                        for (let i = 0; i < 5000000; i++) {
                            result += Math.sqrt(i) * Math.sin(i);
                        }
                        return { 
                            computed: true, 
                            duration: Date.now() - start,
                            output: 'AI task completed'
                        };
                    }
                    
                    function simulateImageProcessing(data) {
                        const start = Date.now();
                        let result = 0;
                        for (let i = 0; i < 3000000; i++) {
                            result += Math.cos(i) * Math.tan(i);
                        }
                        return { 
                            computed: true, 
                            duration: Date.now() - start,
                            output: 'Image processed'
                        };
                    }
                    
                    function simulateVideo(data) {
                        const start = Date.now();
                        let result = 0;
                        for (let i = 0; i < 8000000; i++) {
                            result += Math.sqrt(i);
                        }
                        return { 
                            computed: true, 
                            duration: Date.now() - start,
                            output: 'Video transcoded'
                        };
                    }
                    
                    function simulateGameStream(data) {
                        return { 
                            computed: true, 
                            duration: 500,
                            output: 'Game stream initialized'
                        };
                    }
                    
                    function simulateDataProcessing(data) {
                        const start = Date.now();
                        let result = 0;
                        for (let i = 0; i < 4000000; i++) {
                            result += Math.log(i + 1);
                        }
                        return { 
                            computed: true, 
                            duration: Date.now() - start,
                            output: 'Data processed'
                        };
                    }
                `;
                
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                const workerUrl = URL.createObjectURL(blob);
                
                for (let i = 0; i < this.numWorkers; i++) {
                    this.workers.push({
                        id: `worker-${i}`,
                        worker: new Worker(workerUrl),
                        busy: false
                    });
                }
            }

            async dispatch(action, payload) {
                if (!this.ready) throw new Error('CSOP not initialized');

                const [domain, operation] = action.split('.');
                
                if (domain === 'storage') {
                    return await this.handleStorage(operation, payload);
                } else if (domain === 'compute') {
                    return await this.handleCompute(operation, payload);
                }
            }

            async handleStorage(operation, payload) {
                const storage = JSON.parse(localStorage.getItem('nexus_fabric') || '{}');
                
                switch(operation) {
                    case 'save':
                        storage[payload.key] = payload.data;
                        localStorage.setItem('nexus_fabric', JSON.stringify(storage));
                        return { status: 'ok' };
                    case 'get':
                        if (!(payload.key in storage)) throw new Error('Key not found');
                        return { status: 'ok', data: storage[payload.key] };
                    case 'delete':
                        delete storage[payload.key];
                        localStorage.setItem('nexus_fabric', JSON.stringify(storage));
                        return { status: 'ok' };
                    default:
                        throw new Error('Unknown operation');
                }
            }

            async handleCompute(operation, payload) {
                const availableWorker = this.workers.find(w => !w.busy);
                if (!availableWorker) throw new Error('No available workers');

                return new Promise((resolve, reject) => {
                    availableWorker.busy = true;
                    const taskId = Math.random().toString(36).substr(2, 9);
                    
                    const timeout = setTimeout(() => {
                        availableWorker.busy = false;
                        reject(new Error('Task timeout'));
                    }, 60000);
                    
                    availableWorker.worker.onmessage = (e) => {
                        clearTimeout(timeout);
                        availableWorker.busy = false;
                        
                        if (e.data.status === 'ok') {
                            resolve({ 
                                status: 'ok', 
                                data: e.data.result,
                                workerId: availableWorker.id
                            });
                        } else {
                            reject(new Error(e.data.error));
                        }
                    };
                    
                    availableWorker.worker.postMessage({
                        id: taskId,
                        task: payload.task,
                        data: payload.data
                    });
                });
            }
        }

        // FABRIC STATE
        class FabricState {
            constructor(csop) {
                this.csop = csop;
                this.earnings = 0;
                this.tasks = [];
                this.transactions = [];
                this.providerMode = false;
                this.providerPrice = 0.50;
                this.providerEarnings = 0;
                this.pricingModel = 'paid';
            }

            async init() {
                await this.load();
                this.startMonitoring();
                this.renderAll();
            }

            async load() {
                try {
                    const state = await this.csop.dispatch('storage.get', { key: 'fabric_state' });
                    Object.assign(this, state.data);
                } catch (e) {}
            }

            async save() {
                try {
                    await this.csop.dispatch('storage.save', {
                        key: 'fabric_state',
                        data: {
                            earnings: this.earnings,
                            tasks: this.tasks,
                            transactions: this.transactions,
                            providerMode: this.providerMode,
                            providerPrice: this.providerPrice,
                            providerEarnings: this.providerEarnings,
                            pricingModel: this.pricingModel
                        }
                    });
                } catch (e) {}
            }

            async addTask(useCase) {
                // Calculate final price based on provider pricing
                const finalPrice = this.pricingModel === 'free' ? 0 : 
                                 this.pricingModel === 'paid' ? this.providerPrice : 
                                 useCase.basePrice;

                const task = {
                    id: useCase.id,
                    title: useCase.title,
                    category: useCase.category,
                    icon: useCase.icon,
                    price: finalPrice,
                    progress: 0,
                    status: 'pending',
                    startTime: Date.now()
                };
                
                this.tasks.push(task);
                await this.save();
                this.renderTasks();
                this.updateStats();
                
                this.executeTask(task, useCase);
            }

            async executeTask(task, useCase) {
                task.status = 'running';
                this.renderTasks();

                try {
                    // Map category to task type
                    const taskTypeMap = {
                        'ai': 'ai_inference',
                        'image': 'image_process',
                        'video': 'video_transcode',
                        'gaming': 'game_stream',
                        'data': 'data_process'
                    };

                    const result = await this.csop.dispatch('compute.execute', {
                        task: taskTypeMap[useCase.category] || 'ai_inference',
                        data: { useCase: useCase.id }
                    });

                    // Simulate progress
                    for (let progress = 0; progress <= 100; progress += 20) {
                        task.progress = progress;
                        this.renderTasks();
                        await new Promise(r => setTimeout(r, 800));
                    }

                    task.status = 'completed';
                    task.progress = 100;
                    task.completedTime = Date.now();

                    // User pays for task
                    if (task.price > 0) {
                        this.addTransaction({
                            id: `tx_${Date.now()}`,
                            type: 'spent',
                            amount: task.price,
                            taskId: task.id,
                            timestamp: Date.now(),
                            description: `${task.title}`
                        });
                    }

                    // If provider mode active, earn from completing tasks
                    if (this.providerMode) {
                        const providerEarning = task.price * 0.8; // Provider gets 80%
                        this.providerEarnings += providerEarning;
                        
                        this.addTransaction({
                            id: `tx_${Date.now()}_p`,
                            type: 'earned_provider',
                            amount: providerEarning,
                            taskId: task.id,
                            timestamp: Date.now(),
                            description: `Provider: ${task.title}`
                        });
                    }

                    await this.save();
                    this.renderAll();
                    showToast(`${task.icon} ${task.title} completed!`, 'success');

                } catch (error) {
                    task.status = 'failed';
                    showToast(`Task failed: ${error.message}`, 'error');
                    await this.save();
                    this.renderAll();
                }
            }

            addTransaction(tx) {
                this.transactions.unshift(tx);
                if (this.transactions.length > 100) {
                    this.transactions = this.transactions.slice(0, 100);
                }
                this.save();
                this.renderTransactions();
            }

            startMonitoring() {
                setInterval(() => {
                    this.updateStats();
                }, 3000);
            }

            updateStats() {
                const completedTasks = this.tasks.filter(t => t.status === 'completed').length;
                const totalSpent = this.transactions
                    .filter(t => t.type === 'spent')
                    .reduce((sum, t) => sum + t.amount, 0);

                document.getElementById('total-earnings').textContent = `$${this.providerEarnings.toFixed(2)}`;
                document.getElementById('tasks-completed').textContent = completedTasks;
                document.getElementById('provider-earnings').textContent = `$${this.providerEarnings.toFixed(2)}`;

                const totalBalance = this.providerEarnings - totalSpent;
                document.getElementById('user-balance').textContent = `$${totalBalance.toFixed(2)}`;
                document.getElementById('wallet-balance').textContent = `$${totalBalance.toFixed(2)}`;
                document.getElementById('consumer-balance').textContent = `-$${totalSpent.toFixed(2)}`;
                document.getElementById('provider-balance').textContent = `+$${this.providerEarnings.toFixed(2)}`;

                const activeTasks = this.tasks.filter(t => t.status === 'running').length;
                document.getElementById('active-tasks-count').textContent = `${activeTasks} ACTIVE`;

                if (this.providerMode) {
                    document.getElementById('provider-status-badge').textContent = 'ACTIVE';
                    document.getElementById('provider-status-badge').className = 'text-xs font-bold text-emerald-500 bg-emerald-500/10 px-2 py-1 rounded';
                }
            }

            renderTasks() {
                const container = document.getElementById('task-list');
                const activeTasks = this.tasks.filter(t => t.status !== 'completed').slice(0, 10);

                if (activeTasks.length === 0) {
                    container.innerHTML = `
                        <tr>
                            <td colspan="5" class="px-6 py-8 text-center text-slate-500">
                                <div class="flex flex-col items-center gap-2">
                                    <i data-lucide="inbox" class="w-8 h-8 text-slate-700"></i>
                                    <span class="text-xs">No active tasks. Browse marketplace!</span>
                                </div>
                            </td>
                        </tr>
                    `;
                    lucide.createIcons();
                    return;
                }

                const categoryColors = {
                    'ai': 'purple',
                    'image': 'blue',
                    'video': 'pink',
                    'gaming': 'emerald',
                    'data': 'amber'
                };

                container.innerHTML = activeTasks.map(task => {
                    const color = categoryColors[task.category] || 'blue';
                    const statusColor = task.status === 'running' ? 'blue' : task.status === 'failed' ? 'red' : 'slate';
                    
                    return `
                        <tr class="border-b border-white/5 hover:bg-white/2 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-2">
                                    <span class="text-lg">${task.icon}</span>
                                    <span class="text-sm font-bold text-white">${task.title}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-0.5 bg-${color}-500/10 text-${color}-400 rounded text-[10px] font-bold uppercase">${task.category}</span>
                            </td>
                            <td class="px-6 py-4 w-48">
                                <div class="w-full bg-white/5 h-1 rounded-full overflow-hidden">
                                    <div class="bg-${color}-500 h-full transition-all duration-500" style="width: ${task.progress}%;"></div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-2">
                                    <div class="w-1.5 h-1.5 rounded-full bg-${statusColor}-500 ${task.status === 'running' ? 'status-pulse' : ''}"></div>
                                    <span class="text-[10px] font-bold uppercase text-${statusColor}-500">${task.status}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 font-mono text-xs ${task.price === 0 ? 'text-emerald-400' : 'text-slate-400'}">
                                ${task.price === 0 ? 'FREE' : '$' + task.price.toFixed(2)}
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            renderTransactions() {
                const container = document.getElementById('transaction-list');
                
                if (this.transactions.length === 0) {
                    container.innerHTML = `
                        <div class="px-8 py-12 text-center text-slate-500">
                            <i data-lucide="wallet" class="w-12 h-12 text-slate-700 mx-auto mb-2"></i>
                            <p class="text-xs">No transactions yet</p>
                        </div>
                    `;
                    lucide.createIcons();
                    return;
                }

                container.innerHTML = this.transactions.map(tx => {
                    const isEarned = tx.type.includes('earned');
                    const date = new Date(tx.timestamp);
                    
                    return `
                        <div class="px-8 py-4 border-b border-white/5 hover:bg-white/2 transition-all flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 bg-${isEarned ? 'emerald' : 'red'}-500/10 text-${isEarned ? 'emerald' : 'red'}-500 rounded-full flex items-center justify-center">
                                    <i data-lucide="${isEarned ? 'arrow-up' : 'arrow-down'}" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <div class="text-sm font-bold text-white">${tx.description}</div>
                                    <div class="text-[10px] text-slate-500 font-mono">${date.toLocaleDateString()} â€¢ ${date.toLocaleTimeString()}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-black text-${isEarned ? 'emerald' : 'red'}-400">${isEarned ? '+' : '-'} $${tx.amount.toFixed(2)}</div>
                                <div class="text-[10px] text-slate-600 uppercase font-mono">${isEarned ? 'Provider' : 'Consumer'}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                lucide.createIcons();
            }

            renderMarketplace(category = 'all') {
                const container = document.getElementById('marketplace-grid');
                let allUseCases = [];
                
                if (category === 'all') {
                    Object.values(USE_CASES).forEach(categoryArray => {
                        allUseCases = allUseCases.concat(categoryArray);
                    });
                } else {
                    allUseCases = USE_CASES[category] || [];
                }

                const categoryColors = {
                    'ai': 'purple',
                    'image': 'blue',
                    'video': 'pink',
                    'gaming': 'emerald',
                    'data': 'amber'
                };

                container.innerHTML = allUseCases.map(useCase => {
                    const color = categoryColors[useCase.category];
                    const finalPrice = this.pricingModel === 'free' ? 0 : 
                                     this.pricingModel === 'paid' ? this.providerPrice : 
                                     useCase.basePrice;
                    
                    return `
                        <div class="glass p-6 rounded-2xl border border-white/5 hover:border-${color}-500/50 transition-all group">
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-3xl">${useCase.icon}</span>
                                <span class="px-2 py-0.5 bg-${color}-500/10 text-${color}-400 rounded text-[10px] font-bold uppercase">${useCase.category}</span>
                            </div>
                            <h4 class="text-white font-bold text-lg mb-2 group-hover:text-${color}-400 transition-colors">${useCase.title}</h4>
                            <p class="text-xs text-slate-400 mb-6 leading-relaxed">${useCase.description}</p>
                            
                            <div class="grid grid-cols-2 gap-3 mb-6">
                                <div class="bg-white/2 p-2 rounded-lg border border-white/5">
                                    <div class="text-[9px] text-slate-500 uppercase font-mono">Duration</div>
                                    <div class="text-xs font-bold text-slate-200">${useCase.duration}</div>
                                </div>
                                <div class="bg-white/2 p-2 rounded-lg border border-white/5">
                                    <div class="text-[9px] text-slate-500 uppercase font-mono">Requirements</div>
                                    <div class="text-xs font-bold text-slate-200">${useCase.requirements.cores} cores</div>
                                </div>
                            </div>

                            <div class="bg-${color}-500/10 border border-${color}-500/20 p-3 rounded-lg mb-4">
                                <div class="text-[9px] text-${color}-400 uppercase font-bold mb-1">Device Support</div>
                                <div class="text-xs text-slate-300">${useCase.requirements.ram} RAM â€¢ ${useCase.requirements.cores} CPU cores</div>
                                <div class="text-[9px] text-emerald-400 mt-1">âœ“ Works on weak phones</div>
                            </div>
                            
                            <div class="flex items-center justify-between border-t border-white/5 pt-4">
                                <div>
                                    <div class="text-2xl font-black text-white">
                                        ${finalPrice === 0 ? '<span class="text-emerald-400">FREE</span>' : '$' + finalPrice.toFixed(2)}
                                    </div>
                                    ${finalPrice !== useCase.basePrice ? `<div class="text-[10px] text-slate-500 line-through">$${useCase.basePrice.toFixed(2)}</div>` : ''}
                                </div>
                                <button onclick="acceptTask('${useCase.id}')" class="px-4 py-2 bg-white/5 hover:bg-${color}-600 text-white rounded-xl text-xs font-bold transition-all border border-white/10 hover:border-${color}-400 flex items-center gap-2">
                                    <i data-lucide="play" class="w-3 h-3"></i> Start Task
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                lucide.createIcons();
            }

            renderAll() {
                this.updateStats();
                this.renderTasks();
                this.renderTransactions();
                this.renderMarketplace();
            }
        }

        // UTILITY FUNCTIONS
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const colors = {
                success: 'bg-emerald-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-amber-500'
            };
            
            const icons = {
                success: 'check-circle',
                error: 'alert-circle',
                info: 'info',
                warning: 'alert-triangle'
            };
            
            const toast = document.createElement('div');
            toast.className = `${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 animate-slide-in border border-white/10`;
            toast.innerHTML = `
                <i data-lucide="${icons[type]}" class="w-5 h-5"></i>
                <span class="font-bold text-sm">${message}</span>
            `;
            
            container.appendChild(toast);
            lucide.createIcons();
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(400px)';
                toast.style.transition = 'all 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateInitStatus(message) {
            document.getElementById('init-status').textContent = message;
        }

        // GLOBAL FUNCTIONS
        let fabric = null;

        window.openProviderModal = function() {
            document.getElementById('provider-modal').classList.add('active');
            document.getElementById('available-cores').textContent = navigator.hardwareConcurrency || 4;
            document.getElementById('available-memory').textContent = navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'N/A';
            lucide.createIcons();
        };

        window.closeProviderModal = function() {
            document.getElementById('provider-modal').classList.remove('active');
        };

        window.activateProvider = async function() {
            if (!fabric) return;
            
            const pricingModel = document.getElementById('pricing-model').value;
            const price = parseFloat(document.getElementById('price-input').value) || 0.50;
            
            fabric.providerMode = true;
            fabric.pricingModel = pricingModel;
            fabric.providerPrice = price;
            
            await fabric.save();
            fabric.renderAll();
            
            closeProviderModal();
            showToast(`Provider mode activated! ${pricingModel === 'free' ? 'Offering free compute' : 'Price: $' + price.toFixed(2)}`, 'success');
        };

        window.acceptTask = async function(useCaseId) {
            if (!fabric) return;
            
            let useCase = null;
            Object.values(USE_CASES).forEach(categoryArray => {
                const found = categoryArray.find(uc => uc.id === useCaseId);
                if (found) useCase = found;
            });
            
            if (!useCase) return;
            
            await fabric.addTask(useCase);
            showToast(`${useCase.icon} Task started: ${useCase.title}`, 'info');
        };

        window.filterCategory = function(category) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
            
            if (fabric) {
                fabric.renderMarketplace(category);
            }
        };

        window.withdrawFunds = async function() {
            if (!fabric) return;
            
            const balance = fabric.providerEarnings;
            if (balance < 1) {
                showToast('Minimum withdrawal is $1', 'warning');
                return;
            }
            
            showToast(`Withdrawal of $${balance.toFixed(2)} initiated!`, 'success');
        };

        // Update pricing model input visibility
        document.getElementById('pricing-model')?.addEventListener('change', function(e) {
            const priceContainer = document.getElementById('price-input-container');
            if (e.target.value === 'free') {
                priceContainer.style.display = 'none';
            } else {
                priceContainer.style.display = 'block';
            }
        });

        // INITIALIZATION
        (async function() {
            try {
                const csop = new CSOP();
                await csop.init();
                
                fabric = new FabricState(csop);
                await fabric.init();
                
                document.getElementById('init-overlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('init-overlay').style.display = 'none';
                }, 500);
                
                showToast('NEXUS FABRIC v4 ready!', 'success');
                
            } catch (error) {
                console.error('Init error:', error);
                showToast('Failed to initialize', 'error');
            }
        })();

    </script>

</body>
</html>